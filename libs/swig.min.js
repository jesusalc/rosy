/*! Swig https://paularmstrong.github.com/swig | https://github.com/paularmstrong/swig/blob/master/LICENSE *//*! Cross-Browser Split 1.0.1 (c) Steven Levithan <stevenlevithan.com>; MIT License An ECMA-compliant, uniform cross-browser split method *//*! Underscore.js (c) 2011 Jeremy Ashkenas | https://github.com/documentcloud/underscore/blob/master/LICENSE *//*! DateZ (c) 2011 Tomo Universalis | https://github.com/TomoUniversalis/DateZ/blob/master/LISENCE */(function(){var e="{{ a }}",t;e.split(/(\{\{.*?\}\})/).length===0&&(t=function(e,n,r){function c(){var e=1;for(e;e<arguments.length-2;e+=1)arguments[e]===undefined&&(a[e]=undefined)}if(Object.prototype.toString.call(n)!=="[object RegExp]")return t._nativeSplit.call(e,n,r);var i=[],s=0,o=(n.ignoreCase?"i":"")+(n.multiline?"m":"")+(n.sticky?"y":""),u,a,f,l;n=RegExp(n.source,o+"g"),e=e.toString(),t._compliantExecNpcg||(u=RegExp("^"+n.source+"$(?!\\s)",o));if(r===undefined||r<0)r=Infinity;else{r=Math.floor(+r);if(!r)return[]}a=n.exec(e);while(a){f=a.index+a[0].length;if(f>s){i.push(e.slice(s,a.index)),!t._compliantExecNpcg&&a.length>1&&a[0].replace(u,c),a.length>1&&a.index<e.length&&Array.prototype.push.apply(i,a.slice(1)),l=a[0].length,s=f;if(i.length>=r)break}n.lastIndex===a.index&&(n.lastIndex+=1),a=n.exec(e)}return s===e.length?(l||!n.test(""))&&i.push(""):i.push(e.slice(s)),i.length>r?i.slice(0,r):i},t._compliantExecNpcg=/()??/.exec("")[1]===undefined,t._nativeSplit=String.prototype.split,String.prototype.split=function(e,n){return t(this,e,n)})})(),swig=function(){var e={},t={},n={},r={},i={},s={};return function(e){function r(e){return{render:function(){return"<pre>"+e.stack+"</pre>"}}}function o(t,n){var s={compileFile:e.compileFile,blocks:{},type:i.TEMPLATE,id:n},o,u,a;if(_config.allowErrors)s.tokens=i.parse.call(s,t,_config.tags,_config.autoescape);else try{s.tokens=i.parse.call(s,t,_config.tags,_config.autoescape)}catch(f){return new r(f)}return u=i.compile.call(s),a=new Function("_context","_parents","_filters","_","_ext",["_parents = _parents ? _parents.slice() : [];","_context = _context || {};","var j = _parents.length,",'    _output = "",',"    _this = this;","while (j--) {","   if (_parents[j] === this.id) {",'         return "Circular import of template " + this.id + " in " + _parents[_parents.length-1];',"   }","}","_parents.push(this.id);",u,"return _output;"].join("")),s.render=function(e,t){if(_config.allowErrors)return a.call(this,e,t,_config.filters,_,_config.extensions);try{return a.call(this,e,t,_config.filters,_,_config.extensions)}catch(n){return new r(n)}},s}function u(e,t){var n=t.filename||e;return _config.cache||t.cache?(CACHE.hasOwnProperty(n)||(CACHE[n]=o(e,n)),CACHE[n]):o(e,n)}config={allowErrors:!1,autoescape:!0,cache:!0,encoding:"utf8",filters:n,root:"/",tags:s,extensions:{},tzOffset:0},_config=_.extend({},config),CACHE={},e.init=function(e){CACHE={},_config=_.extend({},config,e),_config.filters=_.extend(n,e.filters),_config.tags=_.extend(s,e.tags),t.defaultTZOffset=_config.tzOffset},e.compileFile=function(e){var t,n;e[0]==="/"&&(e=e.substr(1));if(_config.cache&&CACHE.hasOwnProperty(e))return CACHE[e];if(typeof window!="undefined")throw new r({stack:"You must pre-compile all templates in-browser. Use `swig.compile(template);`."});n=function(){var n=/^\//.test(e)||/^.:/.test(e)?e:_config.root+"/"+e,r=fs.readFileSync(n,config.encoding);t=u(r,{filename:e})};if(_config.allowErrors)n();else try{n()}catch(i){t=new r(i)}return t},e.compile=function(e,t){t=t||{};var n=u(e,t||{});return function(e,t){return n.render(e,t)}}}(e),function(e){function t(t,n){if(_.isArray(t))return"(true)";t=t.replace(/^this/,"_this.__currentContext");if(e.isLiteral(t))return"(true)";var r=t.split(/(\.|\[|\])/),i="",s=[],o=!1,u=!1;return typeof n=="string"&&n.length&&r.unshift(n),r=_.reject(r,function(e){return e===""}),_.each(r,function(t){if(t==="."){u=!0;return}if(t==="["){o=!0;return}if(t==="]"){o=!1;return}if(!i)i=t;else if(o)if(!e.isStringLiteral(t)){if(u){s[s.length-1]=_.last(s).replace(/\] !== "undefined"$/,"_"+t+'] !== "undefined"'),i=i.replace(/\]$/,"_"+t+"]");return}i+="[___"+t+"]"}else i+="["+t+"]";else i+="."+t;u=!1,s.push("typeof "+i+' !== "undefined"')}),"("+s.join(" && ")+")"}KEYWORDS=/^(Array|ArrayBuffer|Boolean|Date|Error|eval|EvalError|Function|Infinity|Iterator|JSON|Math|Namespace|NaN|Number|Object|QName|RangeError|ReferenceError|RegExp|StopIteration|String|SyntaxError|TypeError|undefined|uneval|URIError|XML|XMLList|break|case|catch|continue|debugger|default|delete|do|else|finally|for|function|if|in|instanceof|new|return|switch|this|throw|try|typeof|var|void|while|with)(?=(\.|$))/,e.isStringLiteral=function(e){if(typeof e!="string")return!1;var t=e.substring(0,1),n=e.charAt(e.length-1,1),r;if(t===n&&(t==="'"||t==='"')){r=e.substr(1,e.length-2).split("").reverse().join("");if(t==="'"&&/'(?!\\)/.test(r)||n==='"'&&/"(?!\\)/.test(r))throw new Error("Invalid string literal. Unescaped quote ("+e[0]+") found.");return!0}return!1},e.isLiteral=function(t){var n=!1;return/^\d+([.]\d+)?$/.test(t)?n=!0:e.isStringLiteral(t)&&(n=!0),n},e.isValidName=function(e){return typeof e=="string"&&e.substr(0,2)!=="__"&&/^([$A-Za-z_]+[$A-Za-z_0-9]*)(\.?([$A-Za-z_]+[$A-Za-z_0-9]*))*$/.test(e)&&!KEYWORDS.test(e)},e.isValidShortName=function(e){return e.substr(0,2)!=="__"&&/^[$A-Za-z_]+[$A-Za-z_0-9]*$/.test(e)&&!KEYWORDS.test(e)},e.isValidBlockName=function(e){return/^[A-Za-z]+[A-Za-z_0-9]*$/.test(e)},e.check=t,e.escapeVarName=function(t,n){if(_.isArray(t))return _.each(t,function(r,i){t[i]=e.escapeVarName(r,n)}),t;t=t.replace(/^this/,"_this.__currentContext");if(e.isLiteral(t))return t;typeof n=="string"&&n.length&&(t=n+"."+t);var r="",i=t.split(/(\.|\[|\])/),s=!1,o=!1;return i=_.reject(i,function(e){return e===""}),_.each(i,function(t){if(t==="."){o=!0;return}if(t==="["){s=!0;return}if(t==="]"){s=!1;return}r?s?e.isStringLiteral(t)?r+="["+t+"]":o?r=r.replace(/\]$/,"_"+t+"]"):r+="[___"+t+"]":r+="."+t:r=t,o=!1}),r},e.wrapMethod=function(t,n,r){var s="(function () {\n",o;return t=t||'""',n?(o=n.args.split(","),o=_.map(o,function(t){var n,r=t.replace(/^\s+/,"");try{n="__"+i.parseVariable(r).name.replace(/\W/g,"_")}catch(o){return t}return e.isValidName(r)?(s+=e.setVar(n,i.parseVariable(r)),n):t}),o=o&&o.length?o.join(","):'""',s+="return ",s+=r?r+'["':"",s+=n.name,s+=r?'"]':"",s+=".call(this",s+=o.length?", "+o:"",s+=");\n",s+"})()"):t},e.wrapFilter=function(t,r){var i="",s="";return t=t||'""',r?(n.hasOwnProperty(r.name)&&(s=r.args?t+", "+r.args:t,i+=e.wrapMethod(t,{name:r.name,args:s},"_filters")),i):t},e.wrapFilters=function(t,n,r,i){var s=e.escapeVarName(t,r);return n&&n.length>0&&_.each(n,function(t){switch(t.name){case"raw":i=!1;return;case"e":case"escape":i=t.args||i;return;default:s=e.wrapFilter(s,t,"_filters")}}),s=s||'""',i&&(s="_filters.escape.call(this, "+s+", "+i+")"),s},e.setVar=function(n,r){var i="",s,o,u;return/\[/.test(r.name)&&(s=r.name.split(/(\[|\])/),o=[],u=!1,_.each(s,function(t){if(t==="")return;if(t==="["){u=!0;return}if(t==="]"){u=!1;return}u&&!e.isStringLiteral(t)&&(i+=e.setVar("___"+t.replace(/\W/g,"_"),{name:t,filters:[],escape:!0}))})),i+="var "+n+' = "";\n'+"if ("+t(r.name)+") {\n"+"    "+n+" = "+e.wrapFilters(r.name,r.filters,null,r.escape)+";\n"+"} else if ("+t(r.name,"_context")+") {\n"+"    "+n+" = "+e.wrapFilters(r.name,r.filters,"_context",r.escape)+";\n"+"}\n",r.filters.length&&(i+=" else if (true) {\n",i+="    "+n+" = "+e.wrapFilters("",r.filters,null,r.escape)+";\n",i+="}\n"),i},e.parseIfArgs=function(t,n){var r=["==","<",">","!=","<=",">=","===","!==","&&","||","in","and","or"],i="Bad if-syntax in `{% if "+t.join(" ")+" %}...",s=[],o,u,a=0;_.each(t,function(t,f){var l=!1,c;/^\(/.test(t)&&(a+=1,t=t.substr(1),s.push({type:"separator",value:"("}));if(/^\![^=]/.test(t)||t==="not")t==="not"?t="":t=t.substr(1),s.push({type:"operator",value:"!"});if(/\)$/.test(t)){if(!a)throw new Error(i);t=t.replace(/\)$/,""),l=!0,a-=1}if(t==="in")u=s.pop(),o="inindex";else if(_.indexOf(r,t)!==-1){if(o==="operator")throw new Error(i);t=t.replace("and","&&").replace("or","||"),s.push({value:t}),o="operator"}else if(t!==""){if(o==="value")throw new Error(i);c=n.parseVariable(t),o==="inindex"?(s.push({preout:u.preout+e.setVar("__op"+f,c),value:"(((_.isArray(__op"+f+") || typeof __op"+f+' === "string") && _.indexOf(__op'+f+", "+u.value+") !== -1) || (typeof __op"+f+' === "object" && '+u.value+" in __op"+f+"))"}),u=null):s.push({preout:e.setVar("__op"+f,c),value:"__op"+f}),o="value"}l&&s.push({type:"separator",value:")"})});if(a>0)throw new Error(i);return s}}(r),function(e){_months={full:["January","February","March","April","May","June","July","August","September","October","November","December"],abbr:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]},_days={full:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],abbr:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],alt:{"-1":"Yesterday",0:"Today",1:"Tomorrow"}},e.defaultTZOffset=0,e.DateZ=function(){function i(e){return e<10?"0"+e:e}function s(){var e=i(Math.floor(Math.abs(n.timezoneOffset)/60)),t=i(Math.abs(n.timezoneOffset)-e*60),r=n.timezoneOffset<0?"+":"-",s=n.tzAbbreviation===undefined?"":" ("+n.tzAbbreviation+")";return"GMT"+r+e+t+s}var t={"default":["getUTCDate","getUTCDay","getUTCFullYear","getUTCHours","getUTCMilliseconds","getUTCMinutes","getUTCMonth","getUTCSeconds","toISOString","toGMTString","toUTCString","valueOf","getTime"],z:["getDate","getDay","getFullYear","getHours","getMilliseconds","getMinutes","getMonth","getSeconds","getYear","toDateString","toLocaleDateString","toLocaleTimeString"],string:["toLocaleString","toString","toTimeString"],zSet:["setDate","setFullYear","setHours","setMilliseconds","setMinutes","setMonth","setSeconds","setTime","setYear"],set:["setUTCDate","setUTCFullYear","setUTCHours","setUTCMilliseconds","setUTCMinutes","setUTCMonth","setUTCSeconds"],"static":["UTC","parse"]},n=this,r;n.date=n.dateZ=arguments.length>1?new Date(Date.UTC.apply(Date,arguments)+(new Date).getTimezoneOffset()*6e4):arguments.length===1?new Date(new Date(arguments[0])):new Date,n.timezoneOffset=n.dateZ.getTimezoneOffset(),_.each(t.z,function(e){n[e]=function(){return n.dateZ[e]()}}),_.each(t.string,function(e){n[e]=function(){return n.dateZ[e].apply(n.dateZ,[]).replace(/GMT[+\-]\\d{4} \\(([a-zA-Z]{3,4})\\)/,s())}}),_.each(t["default"],function(e){n[e]=function(){return n.date[e]()}}),_.each(t["static"],function(e){n[e]=function(){return Date[e].apply(Date,arguments)}}),_.each(t.zSet,function(e){n[e]=function(){return n.dateZ[e].apply(n.dateZ,arguments),n.date=new Date(n.dateZ.getTime()-n.dateZ.getTimezoneOffset()*6e4+n.timezoneOffset*6e4),n}}),_.each(t.set,function(e){n[e]=function(){return n.date[e].apply(n.date,arguments),n.dateZ=new Date(n.date.getTime()+n.date.getTimezoneOffset()*6e4-n.timezoneOffset*6e4),n}}),e.defaultTZOffset&&this.setTimezoneOffset(e.defaultTZOffset)},e.DateZ.prototype={getTimezoneOffset:function(){return this.timezoneOffset},setTimezoneOffset:function(e,t){return this.timezoneOffset=e,t&&(this.tzAbbreviation=t),this.dateZ=new Date(this.date.getTime()+this.date.getTimezoneOffset()*6e4-this.timezoneOffset*6e4),this}},e.d=function(e){return(e.getDate()<10?"0":"")+e.getDate()},e.D=function(e){return _days.abbr[e.getDay()]},e.j=function(e){return e.getDate()},e.l=function(e){return _days.full[e.getDay()]},e.N=function(e){var t=e.getDay();return t>=1?t+1:7},e.S=function(e){var t=e.getDate();return t%10===1&&t!==11?"st":t%10===2&&t!==12?"nd":t%10===3&&t!==13?"rd":"th"},e.w=function(e){return e.getDay()},e.z=function(t,n,r){var i=t.getFullYear(),s=new e.DateZ(i,t.getMonth(),t.getDate(),12,0,0),o=new e.DateZ(i,0,1,12,0,0);return s.setTimezoneOffset(n,r),o.setTimezoneOffset(n,r),Math.round((s-o)/864e5)},e.W=function(e){var t=new Date(e.valueOf()),n=(e.getDay()+6)%7,r;return t.setDate(t.getDate()-n+3),r=t.valueOf(),t.setMonth(0,1),t.getDay()!==4&&t.setMonth(0,1+(4-t.getDay()+7)%7),1+Math.ceil((r-t)/6048e5)},e.F=function(e){return _months.full[e.getMonth()]},e.m=function(e){return(e.getMonth()<9?"0":"")+(e.getMonth()+1)},e.M=function(e){return _months.abbr[e.getMonth()]},e.n=function(e){return e.getMonth()+1},e.t=function(e){return 32-(new Date(e.getFullYear(),e.getMonth(),32)).getDate()},e.L=function(e){return(new Date(e.getFullYear(),1,29)).getDate()===29},e.o=function(e){var t=new Date(e.valueOf());return t.setDate(t.getDate()-(e.getDay()+6)%7+3),t.getFullYear()},e.Y=function(e){return e.getFullYear()},e.y=function(e){return e.getFullYear().toString().substr(2)},e.a=function(e){return e.getHours()<12?"am":"pm"},e.A=function(e){return e.getHours()<12?"AM":"PM"},e.B=function(e){var t=e.getUTCHours(),n;return t=t===23?0:t+1,n=Math.abs(((t*60+e.getUTCMinutes())*60+e.getUTCSeconds())/86.4).toFixed(0),"000".concat(n).slice(n.length)},e.g=function(e){var t=e.getHours();return t===0?12:t>12?t-12:t},e.G=function(e){return e.getHours()},e.h=function(e){var t=e.getHours();return(t<10||12<t&&22>t?"0":"")+(t<12?t:t-12)},e.H=function(e){var t=e.getHours();return(t<10?"0":"")+t},e.i=function(e){var t=e.getMinutes();return(t<10?"0":"")+t},e.s=function(e){var t=e.getSeconds();return(t<10?"0":"")+t},e.O=function(e){var t=e.getTimezoneOffset();return(t<0?"-":"+")+(t/60<10?"0":"")+t/60+"00"},e.Z=function(e){return e.getTimezoneOffset()*60},e.c=function(e){return e.toISOString()},e.r=function(e){return e.toUTCString()},e.U=function(e){return e.getTime()/1e3}}(t),function(e){e.add=function(e,t){return _.isArray(e)&&_.isArray(t)?e.concat(t):typeof e=="object"&&typeof t=="object"?_.extend(e,t):_.isNumber(e)&&_.isNumber(t)?e+t:e+t},e.addslashes=function(t){return typeof t=="object"?(_.each(t,function(n,r){t[r]=e.addslashes(n)}),t):t.replace(/\\/g,"\\\\").replace(/\'/g,"\\'").replace(/\"/g,'\\"')},e.capitalize=function(t){return typeof t=="object"?(_.each(t,function(n,r){t[r]=e.capitalize(n)}),t):t.toString().charAt(0).toUpperCase()+t.toString().substr(1).toLowerCase()},e.date=function(e,n,r,i){var s=n.length,o=new t.DateZ(e),u,a=0,f="";r&&o.setTimezoneOffset(r,i);for(a;a<s;a+=1)u=n.charAt(a),t.hasOwnProperty(u)?f+=t[u](o,r,i):f+=u;return f},e["default"]=function(e,t){return typeof e=="undefined"||!e&&typeof e!="number"?t:e},e.escape=e.e=function(e,t){t=t||"html";if(typeof e=="string"){if(t==="js"){var n=0,r,i="";e=e.replace(/\\/g,"\\u005C");for(n;n<e.length;n+=1)r=e.charCodeAt(n),r<32?(r=r.toString(16).toUpperCase(),r=r.length<2?"0"+r:r,i+="\\u00"+r):i+=e[n];return i.replace(/&/g,"\\u0026").replace(/</g,"\\u003C").replace(/>/g,"\\u003E").replace(/\'/g,"\\u0027").replace(/"/g,"\\u0022").replace(/\=/g,"\\u003D").replace(/-/g,"\\u002D").replace(/;/g,"\\u003B")}return e.replace(/&(?!amp;|lt;|gt;|quot;|#39;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}return e},e.first=function(e){return typeof e=="object"&&!_.isArray(e)?"":typeof e=="string"?e.substr(0,1):_.first(e)},e.join=function(e,t){if(_.isArray(e))return e.join(t);if(typeof e=="object"){var n=[];return _.each(e,function(e,t){n.push(e)}),n.join(t)}return e},e.json_encode=function(e){return JSON.stringify(e)},e.last=function(e){return typeof e=="object"&&!_.isArray(e)?"":typeof e=="string"?e.charAt(e.length-1):_.last(e)},e.length=function(e){return typeof e=="object"?_.keys(e).length:e.length},e.lower=function(t){return typeof t=="object"?(_.each(t,function(n,r){t[r]=e.lower(n)}),t):t.toString().toLowerCase()},e.replace=function(e,t,n,r){var i=new RegExp(t,r);return e.replace(i,n)},e.reverse=function(e){return _.isArray(e)?e.reverse():e},e.striptags=function(t){return typeof t=="object"?(_.each(t,function(n,r){t[r]=e.striptags(n)}),t):t.toString().replace(/(<([^>]+)>)/ig,"")},e.title=function(t){return typeof t=="object"?(_.each(t,function(n,r){t[r]=e.title(n)}),t):t.toString().replace(/\w\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()})},e.uniq=function(e){return _.uniq(e)},e.upper=function(t){return typeof t=="object"?(_.each(t,function(n,r){t[r]=e.upper(n)}),t):t.toString().toUpperCase()},e.url_encode=function(e){return encodeURIComponent(e)},e.url_decode=function(e){return decodeURIComponent(e)}}(n),function(e){function t(e){return e.match(/^[\w\.]+/)[0]}function n(e){return e.replace(/\\/g,"\\\\")}function i(e){return n(e.replace(/^[\w\.]+\(|\)$/g,""))}function s(e,t){function a(e,n){var r=new RegExp("\\"+n+"$"),i=e,s="";while(!r.test(s)&&i<t.length)s+=" "+t[i],t[i]=null,i+=1;if(!r.test(s))throw new Error("Malformed arguments sent to tag.");return s.replace(/^ /,"")}t=_.map(t,n);var r=0,i=t.length,s,o,u=[];for(r;r<i;r+=1){s=t[r];if(s===null||/^\s+$/.test(s))continue;if(/^\"/.test(s)&&!/\"[\]\}]?$/.test(s)||/^\'/.test(s)&&!/\'[\]\}]?$/.test(s)||/^\{/.test(s)&&!/\}$/.test(s)||/^\[/.test(s)&&!/\]$/.test(s)){switch(s.substr(0,1)){case"'":o="'";break;case'"':o='"';break;case"[":o="]";break;case"{":o="}"}u.push(a(r,o));continue}u.push(s)}return u}variableRegexp=/^\{\{.*?\}\}$/,logicRegexp=/^\{%[^\r]*?%\}$/,commentRegexp=/^\{#[^\r]*?#\}$/,TEMPLATE=e.TEMPLATE=0,LOGIC_TOKEN=1,VAR_TOKEN=2,e.TOKEN_TYPES={TEMPLATE:TEMPLATE,LOGIC:LOGIC_TOKEN,VAR:VAR_TOKEN},e.parseVariable=function(e,n){if(!e)return{type:null,name:"",filters:[],escape:n};var r=[],s=e.replace(/^\{\{ *| *\}\}$/g,"").split("|"),o=s.shift(),u=0,a=s.length,f=null,l,c;/\(/.test(o)&&(f=i(o.replace(/^\w+\./,"")),o=t(o));for(u;u<a;u+=1)c=s[u],c&&(/^[\w\.]+\(/.test(c)||/\)$/.test(c))&&!/^[\w\.]+\([^\)]*\)$/.test(c)&&(s[u]+="|"+s[u+1],s[u+1]=!1);s=_.without(s,!1),u=0,a=s.length;for(u;u<a;u+=1)c=s[u],l=t(c),/\(/.test(c)?r.push({name:l,args:i(c)}):r.push({name:l,args:""});return{type:VAR_TOKEN,name:o,args:f,filters:r,escape:n}},e.parse=function(t,n,r){var i=t.replace(/(^\s+)|(\s+$)/g,"").split(/(\{%[^\r]*?%\}|\{\{.*?\}\}|\{#[^\r]*?#\})/),o=!!r,u=o,a=[[]],f=0,l=0,c=i.length,h=[],p,d,v,m,g,y,b,w,E=1,S=1,x=null,T,N=/^\{\% *raw *\%\}/,C=/\{\% *endraw *\%\}$/,k=!1,L=!1,A=!1,O=!1,M=!1;for(l;l<c;l+=1){v=i[l],S=E,x=v.match(/\n/g),L=!1,A=!1,O=!1,M=!1,x&&(E+=x.length);if(k!==!1&&!C.test(v)){k+=v;continue}if(v.length===0||commentRegexp.test(v))continue;if(/^(\s|\n)+$/.test(v))v=v.replace(/ +/," ").replace(/\n+/,"\n");else if(variableRegexp.test(v))v=e.parseVariable(v,o);else if(logicRegexp.test(v)){if(C.test(v)){v=k+v.replace(C,""),k=!1,a[f].push(v);continue}if(N.test(v)){k=v.replace(N,"");continue}m=v.replace(/^\{%\s*|\s*%\}$/g,"").split(" "),m[0]==="-"&&(A=!0,m.shift()),w=m.shift(),_.last(m)==="-"&&(L=!0,m.pop());if(f>0&&/^end/.test(w)){T=_.last(a[a.length-2]);if("end"+T.name===w){T.name==="autoescape"&&(o=u),T.strip.end=A,T.strip.after=L,a.pop(),f-=1;continue}throw new Error('Expected end tag for "'+T.name+'", but found "'+w+'" at line '+E+".")}if(!n.hasOwnProperty(w))throw new Error("Unknown logic tag at line "+E+': "'+w+'".');w==="autoescape"&&(u=o,o=!m.length||m[0]==="true"?m.length>=2?m[1]:!0:!1),v={type:LOGIC_TOKEN,line:S,name:w,compile:n[w],parent:_.uniq(a[a.length-2]||[]),strip:{before:A,after:L,start:!1,end:!1}},v.args=s(v,m);if(n[w].ends){v.strip.after=!1,v.strip.start=L,a[f].push(v),a.push(v.tokens=[]),f+=1;continue}}a[f].push(v)}if(k!==!1)throw new Error('Missing expected end tag for "raw" on line '+S+".");if(f!==0)throw T=_.last(a[a.length-2]),new Error('Missing end tag for "'+T.name+'" that was opened on line '+T.line+".");return a[f]},e.compile=function o(t,i){var s="",u=[],a=[],f,l,c,h,p;return t=t||"",this.type===TEMPLATE&&(_.each(this.tokens,function(e,n){if(e.name==="extends"){l=e.args[0];if(!r.isStringLiteral(l)||e.args.length>1)throw new Error("Extends tag on line "+e.line+" accepts exactly one string literal as an argument.");if(n>0)throw new Error('Extends tag must be the first tag in the template, but "extends" found on line '+e.line+".");e.template=this.compileFile(l.replace(/['"]/g,"")),this.parent=e.template}else if(e.name==="block"){c=e.args[0];if(!r.isValidBlockName(c)||e.args.length!==1)throw new Error('Invalid block tag name "'+c+'" on line '+e.line+".");if(this.type!==TEMPLATE)throw new Error('Block "'+c+'" found nested in another block tag on line'+e.line+".");try{this.hasOwnProperty("parent")&&this.parent.blocks.hasOwnProperty(c)?this.blocks[c]=o.call(e,t+"  ",this.parent.blocks[c]):this.hasOwnProperty("blocks")&&(this.blocks[c]=o.call(e,t+"  "))}catch(i){throw new Error("Circular extends found on line "+e.line+' of "'+this.id+'"!')}}else if(e.name==="set"){a.push(e);return}u.push(e)},this),u.length&&u[0].name==="extends"&&(this.blocks=_.extend({},this.parent.blocks,this.blocks),this.tokens=a.concat(this.parent.tokens)),a=u=null),_.each(this.tokens,function(o,u){var a,f,l,c,h;if(typeof o=="string")return c=this.tokens[u-1],h=this.tokens[u+1],c&&c.strip&&c.strip.after&&(o=o.replace(/^\s+/,"")),h&&h.strip&&h.strip.before&&(o=o.replace(/\s+$/,"")),s+='_output += "'+n(o).replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/"/g,'\\"')+'";\n',s;if(typeof o!="object")return;o.type===VAR_TOKEN&&(a=o.name.replace(/\W/g,"_"),f=r.isLiteral(a)?'["'+a+'"]':"."+a,l=o.args&&o.args.length?o.args:"",s+='if (typeof _context !== "undefined" && typeof _context'+f+' === "function") {\n',p=r.wrapMethod("",{name:a,args:l},"_context"),s+='    _output = (typeof _output === "undefined") ? '+p+": _output + "+p+";\n",r.isValidName(a)&&(s+="} else if (typeof "+a+' === "function") {\n',p=r.wrapMethod("",{name:a,args:l}),s+='    _output = (typeof _output === "undefined") ? '+p+": _output + "+p+";\n"),s+="} else {\n",s+=r.setVar("__"+a,o),s+='    _output = (typeof _output === "undefined") ? __'+a+": _output + __"+a+";\n",s+="}\n");if(o.type!==LOGIC_TOKEN)return;if(o.name==="block"){if(this.type!==TEMPLATE)throw new Error('Block "'+o.args[0]+'" found nested in another block tag on line '+o.line+".");this.hasOwnProperty("blocks")&&(s+=this.blocks[o.args[0]])}else o.name==="parent"?s+=t+"  "+i:(o.strip.start&&o.tokens.length&&typeof o.tokens[0]=="string"&&(o.tokens[0]=o.tokens[0].replace(/^\s+/,"")),o.strip.end&&o.tokens.length&&typeof _.last(o.tokens)=="string"&&(o.tokens[o.tokens.length-1]=_.last(o.tokens).replace(/\s+$/,"")),s+=o.compile(t+"  ",i,e))},this),s}}(i),s.autoescape=function(){return module={},module.exports=function(e,t,n){return n.compile.apply(this,[e,t])},module.exports.ends=!0,module.exports}(),s.block=function(){return module={},module.exports={ends:!0},module.exports}(),s["else"]=function(){return module={},module.exports=function(e,t,n){var i=_.last(this.parent).name,s=_.clone(this.args),o,u,a;if(i==="for"){if(s.length)throw new Error('"else" tag cannot accept arguments in the "for" context.');return"} if (__loopLength === 0) {\n"}if(i!=="if")throw new Error('Cannot call else tag outside of "if" or "for" context.');return o=s.shift(),u=r.parseIfArgs(s,n),a="",o?(a+="} else if (\n",a+="    (function () {\n",_.each(u,function(e){e.hasOwnProperty("preout")&&e.preout&&(a+=e.preout+"\n")}),a+="return (\n",_.each(u,function(e){a+=e.value+" "}),a+=");\n",a+="    })()\n",a+=") {\n",a):e+"\n} else {\n"},module.exports}(),s["extends"]=function(){return module={},module.exports={},module.exports}(),s.filter=function(){return module={},module.exports=function(e,t,n){var i=_.clone(this.args),s=i.shift(),o=i.length?i.join(", "):"",u="(function () {\n";return u+='    var _output = "";\n',u+=n.compile.apply(this,[e+"    ",t])+"\n",u+="    return _output;\n",u+="})()\n","_output += "+r.wrapFilter(u.replace(/\n/g,""),{name:s,args:o})+";\n"},module.exports.ends=!0,module.exports}(),s["for"]=function(){return module={},module.exports=function(e,t,n){var i=_.clone(this.args),s=i[0],o=i[1],u=n.parseVariable(i[2]),a="",f;e=e||"";if(typeof o!="undefined"&&o!=="in")throw new Error('Invalid syntax in "for" tag');if(!r.isValidShortName(s))throw new Error("Invalid arguments ("+s+') passed to "for" tag');if(!r.isValidName(u.name))throw new Error("Invalid arguments ("+u.name+') passed to "for" tag');return s=r.escapeVarName(s),f='loop.index = __loopIndex + 1;\nloop.index0 = __loopIndex;\nloop.revindex = __loopLength - loop.index0;\nloop.revindex0 = loop.revindex - 1;\nloop.first = (__loopIndex === 0);\nloop.last = (__loopIndex === __loopLength - 1);\n_context["'+s+'"] = __loopIter[loop.key];\n'+n.compile.apply(this,[e+"     ",t]),a='(function () {\n    var loop = {}, __loopKey, __loopIndex = 0, __loopLength = 0,        __ctx_operand = _context["'+s+'"],\n'+"        loop_cycle = function() {\n"+"            var args = _.toArray(arguments), i = loop.index0 % args.length;\n"+"            return args[i];\n"+"        };\n"+r.setVar("__loopIter",u)+"    else {\n"+"        return;\n"+"    }\n"+"    if (_.isArray(__loopIter)) {\n"+"        __loopIndex = 0; __loopLength = __loopIter.length;\n"+"        for (; __loopIndex < __loopLength; __loopIndex += 1) {\n"+"           loop.key = __loopIndex;\n"+f+"        }\n"+'    } else if (typeof __loopIter === "object") {\n'+"        __keys = _.keys(__loopIter);\n"+"        __loopLength = __keys.length;\n"+"        __loopIndex = 0;\n"+"        for (; __loopIndex < __loopLength; __loopIndex += 1) {\n"+"           loop.key = __keys[__loopIndex];\n"+f+"        }\n"+"    }\n"+'    _context["'+s+'"] = __ctx_operand;\n'+"})();\n",a},module.exports.ends=!0,module.exports}(),s["if"]=function(){return module={},module.exports=function(e,t,n){var i=_.clone(this.args),s=r.parseIfArgs(i,n),o="(function () {\n";return _.each(s,function(e){e.hasOwnProperty("preout")&&e.preout&&(o+=e.preout+"\n")}),o+="\nif (\n",_.each(s,function(e){o+=e.value+" "}),o+=") {\n",o+=n.compile.apply(this,[e+"    ",t]),o+="\n}\n",o+="})();\n",o},module.exports.ends=!0,module.exports}(),s["import"]=function(){return module={},module.exports=function(e,t,n){this.args.length!==3;var i=_.clone(this.args),s=i[0],o=i[1],u=i[2],a="";if(!r.isLiteral(s)&&!r.isValidName(s))throw new Error('Invalid attempt to import "'+s+'".');if(o!=="as")throw new Error('Invalid syntax {% import "'+s+'" '+o+" "+u+" %}");return a+="_.extend(_context, (function () {\n",a+='var _context = {}, __ctx = {}, _output = "";\n'+r.setVar("__template",n.parseVariable(s))+"_this.compileFile(__template).render(__ctx, _parents);\n"+"_.each(__ctx, function (item, key) {\n"+'    if (typeof item === "function") {\n'+'        _context["'+u+'_" + key] = item;\n'+"    }\n"+"});\n"+"return _context;\n",a+="})());\n",a},module.exports}(),s.include=function(){return module={},module.exports=function(e,t,n){var i=_.clone(this.args),s=i.shift(),o="_context",u=!1,a="",f;e=e||"";if(!r.isLiteral(s)&&!r.isValidName(s))throw new Error("Invalid arguments passed to 'include' tag.");if(i.length){_.last(i)==="only"&&(o="{}",i.pop()),i.length>1&&i[0]==="ignore"&i[1]==="missing"&&(i.shift(),i.shift(),u=!0);if(i.length&&i[0]!=="with")throw new Error("Invalid arguments passed to 'include' tag.");if(i[0]==="with"){i.shift();if(!i.length)throw new Error("Context for 'include' tag not provided, but expected after 'with' token.");f=i.shift(),o='_context["'+f+'"] || '+f}}return a="(function () {\n"+r.setVar("__template",n.parseVariable(s))+"\n"+"    var includeContext = "+o+";\n",u&&(a+="try {\n"),a+='    if (typeof __template === "string") {\n',a+="        _output += _this.compileFile(__template).render(includeContext, _parents);\n",a+="    }\n",u&&(a+="} catch (e) {}\n"),a+="})();\n",a},module.exports}(),s.macro=function(){return module={},module.exports=function(e,t,n){var r=_.clone(this.args),i=r.shift(),s="",o="";return r.length&&(s=JSON.stringify(r).replace(/^\[|\'|\"|\]$/g,"")),o+="_context."+i+" = function ("+s+") {\n",o+='    var _output = "";\n',o+=n.compile.apply(this,[e+"    ",t]),o+="    return _output;\n",o+="};\n",o},module.exports.ends=!0,module.exports}(),s.parent=function(){return module={},module.exports={},module.exports}(),s.raw=function(){return module={},module.exports={ends:!0},module.exports}(),s.set=function(){return module={},module.exports=function(e,t,n){var i=_.clone(this.args),s=r.escapeVarName(i.shift(),"_context"),o;if(i.shift()!=="=")throw new Error('Invalid token "'+i[1]+'" in {% set '+i[0]+' %}. Missing "=".');return o=i[0],r.isLiteral(o)||/^\{|^\[/.test(o)||o==="true"||o==="false"?" "+s+" = "+o+";":(o=n.parseVariable(o)," "+s+" = "+"(function () {\n"+"    var _output;\n"+n.compile.apply({tokens:[o]},[e,t])+"\n"+"    return _output;\n"+"})();\n")},module.exports}(),e}();